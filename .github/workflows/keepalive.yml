name: Keep Railway Backend Alive

on:
  schedule:
    # HÉ™r 5 dÉ™qiqÉ™dÉ™ bir iÅŸlÉ™yir (daha aggressiv keep-alive)
    - cron: '*/5 * * * *'
  workflow_dispatch:  # Manual test Ã¼Ã§Ã¼n

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    timeout-minutes: 2
    
    steps:
      - name: Double Ping Backend Health Endpoint
        run: |
          # Railway backend URL (fixed)
          BACKEND_URL="https://arazelectron-production.up.railway.app"
          
          # First ping - wake up server
          echo "ğŸ”„ First ping: $BACKEND_URL/api/health"
          response1=$(curl -s -o /dev/null -w "%{http_code}" --max-time 30 "$BACKEND_URL/api/health" || echo "000")
          
          if [ "$response1" = "200" ]; then
            echo "âœ… First ping successful! (HTTP $response1)"
          else
            echo "âš ï¸ First ping returned: HTTP $response1 (server might be waking up)"
          fi
          
          # Wait for server to fully wake up
          echo "â³ Waiting 20 seconds..."
          sleep 20
          
          # Second ping - ensure server is fully awake
          echo "ğŸ”„ Second ping: $BACKEND_URL/api/health"
          response2=$(curl -s -o /dev/null -w "%{http_code}" --max-time 30 "$BACKEND_URL/api/health" || echo "000")
          
          if [ "$response2" = "200" ]; then
            echo "âœ… Second ping successful! (HTTP $response2)"
            echo "ğŸ‰ Backend is fully awake and stable!"
          else
            echo "âŒ Second ping failed: HTTP $response2"
            exit 1
          fi
        continue-on-error: false
        timeout-minutes: 2
          
      - name: Ping Root Endpoint
        run: |
          BACKEND_URL="https://arazelectron-production.up.railway.app"
          
          echo "ğŸ”„ Pinging root: $BACKEND_URL/"
          response=$(curl -s -o /dev/null -w "%{http_code}" --max-time 30 "$BACKEND_URL/" || echo "000")
          
          if [ "$response" = "200" ] || [ "$response" = "404" ]; then
            echo "âœ… Root endpoint responsive! (HTTP $response)"
          else
            echo "âš ï¸ Root endpoint returned: HTTP $response"
          fi
        continue-on-error: true
        timeout-minutes: 1
      
      - name: Final Status
        if: always()
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… Keep-alive ping completed!"
          echo "â° Next ping in 5 minutes"
          echo "ğŸš‚ Railway server is staying awake"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
